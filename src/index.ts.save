import express from "express";
import 'dotenv/config';
import { logger } from '@utils/logger';
import validateEnv from '@utils/validateEnv';
import massive from "massive";

validateEnv();

class Server {
    public server: express.Application;
    public port: string | number;
    public env: string;
    public db: massive.Database;

    constructor() {
        this.server = express();
        this.port = process.env.PORT || 3000;
        this.env = process.env.NODE_ENV || 'development';
    }

    public async listen() {
        await this.connectToDatabase();
        await this.server.listen(this.port);
        logger.info(`=================================`);
        logger.info(`======= ENV: ${this.env} =======`);
        logger.info(`ðŸš€ App listening on the port ${this.port}`);
        logger.info(`=================================`);
    }

    public getServer() {
        return this.server;
    }

    private async connectToDatabase() {
        this.db = await massive({
            host: '127.0.0.1',
            port: 5432,
            database: 'test',
            user: 'test',
            password: 'test'
        })
    }




}

export default new Server();